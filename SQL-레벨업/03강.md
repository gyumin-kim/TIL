# 03강 DBMS와 실행 계획

## 1. 권한 이양의 죄악
- 사용자 or 개발자가 데이터베이스에서 의식적으로 사용하는 것은 SQL 레벨까지
- 사용자는 대상(What)을 기술하기만 하면 되고, 데이터에 접근하기 위한 절차(How)는 DBMS가 알아서 처리하고 결과를 제공해준다.
- 그렇게 하는 것이 비즈니스 전체의 생산성을 향상시키기 때문


## 2. 데이터에 접근하는 방법은 어떻게 결정할까?
- 쿼리 평가 엔진: (RDB에서) 데이터 접근 절차를 결정하는 모듈
![image](https://user-images.githubusercontent.com/26949964/70905960-95222b00-2048-11ea-9828-1a520064f443.png)
1. 파서(parser)
  - parse(구문 분석; ➊)하는 역할. (≒ SQL 구문의 서류심사 단계)
  - 사용자가 입력한 SQL 구문이 올바른지 검사하고, DBMS 내부에서 효율적으로 처리할 수 있도록 정형적인 형식으로 변환
2. 옵티마이저(optimizer)
  - DBMS 두뇌의 핵심
  - 데이터 접근법(실행 계획)을 최적화한다.
  - (인덱스 유무, 데이터 분산 또는 편향의 정도, DBMS 내부 매개변수 등을 고려하여) 선택 가능한 많은 실행 계획을 작성한다(➋).
  - 이들의 비용을 연산한다(➌).
3. 카탈로그 매니저(catalog manager; ➍)
  - catalog: DBMS의 내부 정보(테이블 or 인덱스의 **통계 정보**)를 모아놓은 테이블들
  - optimizer가 실행 계획을 세울 때 중요한 정보를 제공
4. 플랜 평가(plan evaluation)
  - optimizer에서 세운 여러 개의 실행 계획 중 최적의 것(가장 낮은 비용)을 선택한다(➎).
  - 실행 계획은 인간이 쉽게 읽을 수 있는 '계획서'의 형태
  - 선택된 실행 계획을 DBMS가 절차적인 코드로 변환하고, 데이터 접근을 수행


## 3. 옵티마이저와 통계 정보
- optimizer는 catalog의 통계 정보를 기반으로 플랜을 선택한다.
- optimizer가 최적의 플랜을 선택하지 못하는 대표적인 원인은 통계 정보가 부족하기 때문이다.
- 테이블에 삽입/갱신/제거가 수행될 때 catalog 정보가 갱신되지 않아 실제 테이블 or 인덱스와 일치하지 않게 되면, optimizer는 오래된 정보를 바탕으로 실행 계획을 세우게 된다.
- catalog에 포함되어 있는 통계 정보들
  - 각 테이블의 레코드 수
  - 각 테이블의 필드 수와 필드의 크기
  - 필드의 카디널리티(cardinality; 값의 개수)
  - 필드값의 히스토그램(어떤 값이 얼마나 분포되어 있는가)
  - 필드 내부에 있는 NULL 수
  - 인덱스 정보


## 4. 최적의 실행 계획이 작성되게 하려면
> 테이블의 데이터가 많이 바뀌면, 카탈로그의 통계 정보도 함께 갱신해야 한다.
- 통계 정보 갱신은 비용이 많이 들지만, DBMS가 최적의 플랜을 선택하기 위해 필수적인 조건이므로 갱신 시점을 확실하게 검토해야 한다.